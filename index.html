<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>무기력 세계</title>
<style>
@font-face {
  font-family: 'YunChorokwoosanEoriniMinguk';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408@1.0/YoonChildfundkoreaMinGuk.woff2') format('woff2');
  font-weight: normal;
  font-display: swap;
}

:root { --font-size: 1.5rem; }

html, body {
  height: 100%;
  margin: 0;
  overflow: hidden;
}

body {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fafafa;
  font-family: 'YunChorokwoosanEoriniMinguk', sans-serif;
  color: #222;
  position: relative;
}

#message-wrap {
  text-align: center;
  max-width: 90ch;
  transition: opacity 1s ease;
  z-index: 10;
  position: relative;
}

#message {
  font-size: var(--font-size);
  opacity:0;
  transform:translateY(8px);
  transition: opacity 1.5s ease, transform 1.5s ease;
  line-height:1.6;
  font-weight:500;
  letter-spacing:-0.01em;
}

#image-wrap {
  display:none;
  position:absolute;
  top:50%;
  left:50%;
  width:400px;
  height:400px;
  transform:translate(-50%,-50%);
  opacity:0;
  transition: opacity 2s ease;
  z-index:10;
}

#image-wrap img {
  position:absolute;
  width:150px;
  height:150px;
  object-fit:cover;
}

#skip-btn {
  position:absolute;
  bottom:120px;
  padding:10px 20px;
  font-size:1rem;
  border:none;
  background:#ddd;
  border-radius:8px;
  cursor:pointer;
  transition:background 0.3s ease, opacity 1s ease;
  z-index:10;
}
#skip-btn:hover{ background:#ccc; }

#reset-btn {
  position:absolute;
  top:20px;
  right:20px;
  padding:8px 12px;
  font-size:1rem;
  border:none;
  background:#ff6666;
  color:white;
  border-radius:6px;
  cursor:pointer;
  z-index:20;
  transition: background 0.3s ease, opacity 1.5s ease; 
  opacity: 0;
}
#reset-btn:hover { background:#ff4444; }

#title {
  position:absolute;
  top:100px;
  left:20%;
  transform:translate(-50%,10px);
  opacity:0;
  font-size:3rem;
  transition: opacity 2s ease, transform 2s ease;
  z-index:10;
}

#background {
  position: absolute;
  top:0; left:0;
  width:100%; height:100%;
  background: url('zimg/main.png') no-repeat center center / cover;
  opacity:0;
  transition: opacity 2s ease;
  z-index:-1;
}
</style>
</head>
<body>

<div id="message-wrap"><div id="message"></div></div>
<button id="skip-btn">skip</button>
<button id="reset-btn">초기화</button>
<p id="title">"무기력 세계"<br>무기력을 마음껏 즐기고 놓아주자.</p>
<div id="image-wrap"></div>
<div id="background"></div>

<script>
const messages = [
  "오늘 아무것도 안 했네...",
  "누워서 유튜브만 보고",
  "과제한답시고 게임만 했잖아",
  "자괴감 든다...",
  "난 왜 이렇게 무기력하지..?"
];

const mainImages = [
  'zimg/trashcan.png',
  'zimg/palatte.png',
  'zimg/text.png',
  'zimg/nobrain.png',
  'zimg/breathe.png'
];

const paperImage = 'zimg/paper.png';

const FADE_TIME = 1500;
const DISPLAY_TIME = 1500;
const TOTAL_DURATION = FADE_TIME*2 + DISPLAY_TIME;

const messageEl = document.getElementById('message');
const messageWrap = document.getElementById('message-wrap');
const imageWrap = document.getElementById('image-wrap');
const skipBtn = document.getElementById('skip-btn');
const titleEl = document.getElementById('title');
const backgroundEl = document.getElementById('background');
const resetBtn = document.getElementById('reset-btn');

let timers = [];
let skipTriggered = false;
let bgTextInterval;
let stopBgFalling = false;

const positions = [
  {top:'10', left:'50%', transform:'translate(-50%,0)'},
  {top:'50%', left:'90%', transform:'translate(-50%,-50%)'},
  {top:'75%', left:'75%', transform:'translate(-50%,0)'},
  {top:'75%', left:'25%', transform:'translate(-50%,0)'},
  {top:'50%', left:'10', transform:'translate(-50%,-50%)'}
];

const paperPositions = [
  {top:'-5%', left:'50%', transform:'translate(-50%,0)', rotate:'0deg'},
  {top:'50%', left:'90%', transform:'translate(-50%,-50%)', rotate:'35deg'},
  {top:'55%', left:'75%', transform:'translate(-50%,0)', rotate:'-40deg'},
  {top:'60%', left:'25%', transform:'translate(-50%,0)', rotate:'20deg'},
  {top:'50%', left:'10', transform:'translate(-50%,-50%)', rotate:'-5deg'}
];

function scalePosition(pos, scale=1.5){
  const getVal = v => parseFloat(v);
  const top = 50 + (getVal(pos.top) - 50) * scale;
  const left = 50 + (getVal(pos.left) - 50) * scale;
  return {top: top+'%', left: left+'%', transform: pos.transform};
}

const scaledPositions = positions.map(p => scalePosition(p, 1.5));
const scaledPaperPositions = paperPositions.map(p => {
  const scaled = scalePosition(p, 1.5);
  return {...scaled, rotate: p.rotate};
});

function showMessageOnce(i){
  if(skipTriggered) return;
  messageEl.textContent = messages[i];
  messageEl.style.transition='none';
  messageEl.style.opacity='0';
  messageEl.style.transform='translateY(8px)';
  requestAnimationFrame(()=>{
    messageEl.style.transition=`opacity ${FADE_TIME}ms ease, transform ${FADE_TIME}ms ease`;
    messageEl.style.opacity='1';
    messageEl.style.transform='translateY(0px)';
  });
  setTimeout(()=>{
    messageEl.style.opacity='0';
    messageEl.style.transform='translateY(-8px)';
  },FADE_TIME+DISPLAY_TIME);
}

function playSequence(){
  messages.forEach((msg,i)=>{
    const t = setTimeout(()=>showMessageOnce(i), i*TOTAL_DURATION);
    timers.push(t);
  });
  const endTimer = setTimeout(()=>{
    showImages();
    startBackgroundTexts();
  }, messages.length*TOTAL_DURATION+500);
  timers.push(endTimer);
}

function showImages(){
  messageWrap.style.opacity='0';
  skipBtn.style.opacity='0';
  setTimeout(()=>{
    messageWrap.style.display='none';
    skipBtn.style.display='none';
    imageWrap.style.display='block';

    const visitedLinks = JSON.parse(sessionStorage.getItem('visitedLinks') || '[]');

    mainImages.forEach((link, i)=>{
      const paper = document.createElement('img');
      paper.src = paperImage;
      paper.style.zIndex='0';
      paper.style.top = scaledPaperPositions[i].top;
      paper.style.left = scaledPaperPositions[i].left;
      paper.style.transform = `${scaledPaperPositions[i].transform} rotate(${scaledPaperPositions[i].rotate})`;
      paper.style.width = '350px';
      paper.style.height = '350px';
      imageWrap.appendChild(paper);

      const img = document.createElement('img');
      img.src = link;
      img.style.zIndex='1';
      img.style.top = scaledPositions[i].top;
      img.style.left = scaledPositions[i].left;
      img.style.transform = scaledPositions[i].transform;
      img.style.cursor = 'pointer';

      if (visitedLinks.includes(link)) {
        img.style.display = 'none';
      } else {
        img.addEventListener('click', () => {
          visitedLinks.push(link);
          sessionStorage.setItem('visitedLinks', JSON.stringify(visitedLinks));

          // ✅ 5개 전부 방문하면 엔딩 실행
          if (visitedLinks.length === mainImages.length) {
            showEndSequence();
          }

          if(link.includes('palatte.png')){
            window.location.href = 'zhtml/palatte.html';
          } else if(link.includes('trashcan.png')){
            window.location.href = 'zhtml/trashcan.html';
          } else if(link.includes('text.png')){
            window.location.href = 'zhtml/text.html';
          } else if(link.includes('nobrain.png')){
            window.location.href = 'zhtml/nobrain.html';
          } else if(link.includes('breathe.png')){
            window.location.href = 'zhtml/breathe.html';
          }
        });
      }

      imageWrap.appendChild(img);
    });

    requestAnimationFrame(()=>{
      imageWrap.style.opacity='1';
      titleEl.style.opacity='1';
      titleEl.style.transform='translate(-50%,0)';
      backgroundEl.style.opacity='0.6'; 
    });
  },500);
}

function stopBackgroundTexts() {
  stopBgFalling = true;
  clearInterval(bgTextInterval);
  const bgTexts = bgContainer.querySelectorAll('div');
  bgTexts.forEach(t => t.remove());
}

function showEndSequence() {
  stopBackgroundTexts(); 
  const endMessages = [
    "어라... 다 어디갔지?",
    "시간이 된건가...",
    "무기력 세계를 탈출하자"
  ];

  const msgBox = document.createElement('div');
  msgBox.style.position = 'absolute';
  msgBox.style.top = '50%';
  msgBox.style.left = '50%';
  msgBox.style.transform = 'translate(-50%, -50%)';
  msgBox.style.fontSize = '2rem';
  msgBox.style.textAlign = 'center';
  msgBox.style.opacity = '0';
  msgBox.style.transition = 'opacity 1.5s ease';
  msgBox.style.zIndex = '30';
  document.body.appendChild(msgBox);

  let index = 0;
  function showNext() {
    if (index >= endMessages.length) {
      setTimeout(() => {
        sessionStorage.clear();
        location.reload();
      }, 1500);
      return;
    }
    msgBox.textContent = endMessages[index];
    msgBox.style.opacity = '0';
    requestAnimationFrame(() => { msgBox.style.opacity = '1'; });
    setTimeout(() => {
      msgBox.style.opacity = '0';
      setTimeout(() => {
        index++;
        showNext();
      }, 1500);
    }, 2000);
  }
  showNext();
}

skipBtn.addEventListener('click',()=>{
  if(skipTriggered) return;
  skipTriggered=true;
  timers.forEach(t=>clearTimeout(t));
  showImages();
  startBackgroundTexts();
});

if(sessionStorage.getItem('seenMessages') === 'true'){
  skipTriggered = true;
  timers.forEach(t=>clearTimeout(t));
  showImages();
  startBackgroundTexts();
} else {
  playSequence();
  sessionStorage.setItem('seenMessages','true');
}

resetBtn.addEventListener('click', () => {
  sessionStorage.clear();
  location.reload();
});

const bgMessages = [
  '과제하기 싫어어어ㅓㅓ어ㅓ',
  '유튜브 18시간 시청 미쳤다',
  '릴스 5000번 넘기기',
  '12시간 잘거야......',
  '너무 졸려요 ㅠㅠㅠㅠ',
  '며칠밤을 샌거지...',
  '살려주어어어ㅓㅇ',
  '띠리리라라라라핳ㅎ흐흐흐흫',
  '누가 나 대신 움직여...',
  '이불과 한몸이 되고 싶은걸',
  '에어컨 세게 틀고 이불 끝까지 덮기',
  '집 밖은 위험해',
  '약속 취소되서 너무 행복한 상태',
  '내향성 99퍼 인간 살려줘',
  '아무것도 안하고 싶다',
  '누가 나 대신 돈 좀 벌어줘',
  '알바 가기 싫어요ㅠㅠㅠ'
];

const bgContainer = document.createElement('div');
bgContainer.style.position = 'absolute';
bgContainer.style.top = '0';
bgContainer.style.left = '0';
bgContainer.style.width = '100%';
bgContainer.style.height = '100%';
bgContainer.style.pointerEvents = 'none';
bgContainer.style.overflow = 'hidden';
bgContainer.style.zIndex = '-2';
document.body.appendChild(bgContainer);

function createBgText() {
  if (stopBgFalling) return;
  const text = document.createElement('div');
  text.textContent = bgMessages[Math.floor(Math.random() * bgMessages.length)];
  text.style.position = 'absolute';
  text.style.top = '-2rem';
  text.style.left = Math.random() * 100 + '%';
  text.style.fontSize = '1.5rem';
  text.style.opacity = '0.6';
  text.style.whiteSpace = 'nowrap';
  text.style.color = '#222';
  
  bgContainer.appendChild(text);

  const speed = 1 + Math.random() * 1; 
  function fall() {
    if (stopBgFalling) { text.remove(); return; }
    const currentTop = parseFloat(text.style.top);
    if(currentTop > window.innerHeight + 50){
      text.remove();
      if (!stopBgFalling) createBgText(); 
      return;
    }
    text.style.top = currentTop + speed + 'px';
    requestAnimationFrame(fall);
  }
  requestAnimationFrame(fall);
}

function startBackgroundTexts(){
  stopBgFalling = false;
  for(let i=0; i<15; i++){
    setTimeout(createBgText, i*200);
  }
  bgTextInterval = setInterval(createBgText, 1500);
}

window.addEventListener('load', () => {
  requestAnimationFrame(() => {
    resetBtn.style.opacity = '1';
  });
});
</script>
</body>
</html>

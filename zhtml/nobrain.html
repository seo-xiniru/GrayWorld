<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>뇌 빼고 보기</title>
<style>
@font-face {
  font-family: 'YunChorokwoosanEoriniMinguk';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2408@1.0/YoonChildfundkoreaMinGuk.woff2') format('woff2');
  font-weight: normal;
  font-display: swap;
}

#backBtn {
  position: fixed;
  top: 20px;
  left: 20px;
  padding: 8px 12px;
  background: #333;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  z-index: 9999;
  font-size: 14px;
  transition: background 0.3s ease;
}
#backBtn:hover { background: #555; }

body {
  display: flex;
  justify-content: center; 
  align-items: flex-start;
  gap: 20px;
  margin: 0;
  padding: 20px;
  background-color: #f0f0f0;
  font-family: 'YunChorokwoosanEoriniMinguk', sans-serif;
  overflow-x: hidden;
}


.container-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.container {
  position: relative;
  width: 500px;
  height: 80vh;
  background-color: #fff;
  border: 2px dashed #aaa;
  overflow: hidden;
}

.falling-img {
  position: absolute;
}

.buttons {
  margin-top: 20px;
  display: flex;
  gap: 10px;
}

button {
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

#savedImagesWrapper {
  max-height: 80vh;
  overflow-y: auto;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  flex-direction: column;
  gap: 10px;
  width: 320px;
}

#savedImages {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.savedImage {
  border: 1px solid #ccc;
  width: 300px;
}
</style>
</head>
<body>
<button id="backBtn">무기력 세계로 돌아가기</button>

<div class="container-wrapper">
  <div class="container" id="container"></div>
  <div class="buttons">
    <button id="resetBtn">다시하기</button>
    <button id="stopBtn">멈춰!</button>
    <button id="saveBtn">저장하기</button>
  </div>
</div>

<div id="savedImagesWrapper">
  <div id="savedImages"></div>
</div>

<script>
const container = document.getElementById('container');
const resetBtn = document.getElementById('resetBtn');
const stopBtn = document.getElementById('stopBtn');
const saveBtn = document.getElementById('saveBtn');
const savedImages = document.getElementById('savedImages');

const imageLinks = ["1-1.png","1-2.png","1-3.png","1-4.png"];

let fallingImages = [];
const FALL_SPEED = 7;
const SPAWN_INTERVAL = 300;
let isStopped = false;

function createFallingImage() {
  const img = document.createElement('img');
  img.classList.add('falling-img');
  img.src = imageLinks[Math.floor(Math.random() * imageLinks.length)];
  img.onload = () => {
    let w = img.naturalWidth;
    let h = img.naturalHeight;
    if (w > 80) { const ratio = 80 / w; w = 80; h *= ratio; }
    img.style.width = w + 'px';
    img.style.height = h + 'px';
    img.style.left = Math.random() * (container.clientWidth - w) + 'px';
    img.style.top = -h + 'px';
    container.appendChild(img);
    fallingImages.push({el: img, width: w, height: h, x: parseFloat(img.style.left), y: -h});
  };
}

const spawnIntervalId = setInterval(() => { if(!isStopped) createFallingImage(); }, SPAWN_INTERVAL);

function animate() {
  fallingImages.forEach(f => {
    if (!isStopped) {
      f.y += FALL_SPEED;
      if (f.y > container.clientHeight) f.y = -f.height;
      f.el.style.top = f.y + 'px';
    }
  });
  requestAnimationFrame(animate);
}
animate();

stopBtn.addEventListener('click', () => {
  isStopped = !isStopped;
  stopBtn.textContent = isStopped ? "계속!" : "멈춰!";
});

resetBtn.addEventListener('click', () => {
  fallingImages.forEach(f => f.el.remove());
  fallingImages = [];
  isStopped = false;
  stopBtn.textContent = "멈춰!";
});

saveBtn.addEventListener('click', () => {
  const canvas = document.createElement('canvas');
  const canvasWidth = 300;
  const scale = canvasWidth / container.clientWidth;
  let maxY = 0;
  fallingImages.forEach(f => { if(f.y + f.height > maxY) maxY = f.y + f.height; });
  const canvasHeight = Math.max(maxY * scale, 300); // 최소 높이 300
  canvas.width = canvasWidth;
  canvas.height = canvasHeight;

  const ctx = canvas.getContext('2d');
  fallingImages.forEach(f => {
    const img = new Image();
    img.src = f.el.src;
    img.onload = () => {
      ctx.drawImage(img, f.x * scale, f.y * scale, f.width * scale, f.height * scale);
    };
  });

  canvas.classList.add('savedImage');
  savedImages.appendChild(canvas);
});

document.getElementById('backBtn').addEventListener('click', () => {
  window.location.href = "../index.html";
});
</script>
</body>
</html>
